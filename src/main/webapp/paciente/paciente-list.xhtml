<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/templates/template.xhtml">

    <!-- Define o título da página -->
    <ui:define name="titulo">
        Gerenciamento de Pacientes
    </ui:define>

    <!-- Define o conteúdo principal -->
    <ui:define name="conteudo">
        <!-- Growl de mensagens -->
        <h:form id="formMensagens">
            <p:growl id="msgs" showDetail="true" autoUpdate="true" life="3000" />
        </h:form>

        <h:form id="formListaPacientes">

            <p:panel header="Pesquisa de Pacientes" style="margin:20px">
                <p:panelGrid columns="4" columnClasses="label,value,label,value" style="width:100%">
                    <p:outputLabel for="nomeFiltro" value="Nome:"/>
                    <p:inputText id="nomeFiltro" value="#{pacienteBean.nomeFiltro}" />
                    <p:outputLabel for="cpfFiltro" value="CPF:"/>
                    <p:inputMask id="cpfFiltro" mask="999.999.999-99" value="#{pacienteBean.cpfFiltro}" />
                </p:panelGrid>

                <p:toolbar style="margin-top:10px">
                    <p:toolbarGroup>
                        <p:commandButton value="Pesquisar" icon="pi pi-search"
                                        action="#{pacienteBean.pesquisar}" update=":formListaPacientes" />
                    </p:toolbarGroup>

                    <p:toolbarGroup align="right">
                        <!-- Botão para novo paciente -->
                        <p:commandButton value="Novo Paciente" icon="pi pi-user-plus"
                                        action="#{pacienteBean.novo}"
                                        update=":formDialogPaciente"
                                        oncomplete="PF('dlgPaciente').show()" />
                    </p:toolbarGroup>
                </p:toolbar>
            </p:panel>

            <p:panel header="Resultados" style="margin:20px">
                <p:dataTable value="#{pacienteBean.pacientes}" var="p"
                            rows="#{pacienteBean.pageSize}"
                            paginator="true"
                            paginatorPosition="bottom"
                            totalRecords="#{pacienteBean.totalRecords}"
                            lazy="false">

                    <p:column headerText="ID" width="60">#{p.idPaciente}</p:column>
                    <p:column headerText="Nome">#{p.nome}</p:column>
                    <p:column headerText="CPF">#{p.cpf}</p:column>
                    <p:column headerText="Nascimento">
                        <h:outputText value="#{p.dataNascimento}" converter="localDateConverter" />
                    </p:column>
                    <p:column headerText="Sexo">#{p.sexo}</p:column>
                    <p:column headerText="Ativo">
                        <h:outputText value="#{p.ativo ? 'Sim' : 'Não'}" />
                    </p:column>

                    <p:column headerText="Ações" width="180">
                        <p:commandButton icon="pi pi-pencil" title="Editar"
                                        action="#{pacienteBean.editar(p)}"
                                        oncomplete="PF('dlgPaciente').show()"
                                        update=":formDialogPaciente"
                                        value="Editar" />
                        <p:commandButton icon="pi pi-trash" title="Excluir"
                                        action="#{pacienteBean.excluir(p)}"
                                        update=":formListaPacientes :formMensagens"
                                        process="@this"
                                        value="Inativar" />
                    </p:column>
                </p:dataTable>
            </p:panel>

            <!-- Paginação -->
            <p:panelGrid columns="3" style="margin:20px">
                <p:commandButton value="Anterior" icon="pi pi-angle-left"
                                actionListener="#{pacienteBean.paginar(pacienteBean.first - pacienteBean.pageSize)}"
                                update=":formListaPacientes"
                                rendered="#{pacienteBean.first gt 0}" />
                <h:outputText value="Mostrando #{pacienteBean.first + 1} - #{Math.min(pacienteBean.first + pacienteBean.pageSize, pacienteBean.totalRecords)} de #{pacienteBean.totalRecords}" />
                <p:commandButton value="Próximo" icon="pi pi-angle-right"
                                actionListener="#{pacienteBean.paginar(pacienteBean.first + pacienteBean.pageSize)}"
                                update=":formListaPacientes"
                                rendered="#{(pacienteBean.first + pacienteBean.pageSize) lt pacienteBean.totalRecords}" />
            </p:panelGrid>
        </h:form>

        <!-- Diálogo de cadastro -->
        <p:dialog header="Paciente" widgetVar="dlgPaciente"
                modal="true" resizable="false" closable="true"
                id="dlgPaciente" appendTo="@(body)">
            <h:form id="formDialogPaciente">
                <p:panelGrid columns="2" columnClasses="label,value" style="width:100%">
                    <p:outputLabel for="nome" value="Nome:"/>
                    <p:inputText id="nome" value="#{pacienteBean.paciente.nome}"
                                required="true" requiredMessage="O nome é obrigatório."/>

                    <p:outputLabel for="cpf" value="CPF:"/>
                    <p:inputMask id="cpf" mask="999.999.999-99"
                                value="#{pacienteBean.paciente.cpf}"
                                required="true" requiredMessage="O CPF é obrigatório."/>

                    <p:outputLabel for="data" value="Data de Nascimento:"/>
                    <p:calendar id="data"
                                value="#{pacienteBean.paciente.dataNascimento}"
                                pattern="dd/MM/yyyy"
                                locale="pt_BR"
                                converter="localDateConverter"
                                required="true"
                                requiredMessage="A data de nascimento é obrigatória."/>

                    <p:outputLabel for="sexo" value="Sexo:"/>
                    <p:selectOneMenu id="sexo" value="#{pacienteBean.paciente.sexo}" required="true">
                        <f:selectItem itemLabel="Selecione" itemValue="" noSelectionOption="true" />
                        <f:selectItems value="#{pacienteBean.sexos}" var="s" itemValue="#{s}" itemLabel="#{s}" />
                    </p:selectOneMenu>

                    <p:outputLabel for="ativo" value="Ativo:"/>
                    <p:selectBooleanCheckbox id="ativo" value="#{pacienteBean.paciente.ativo}"/>
                </p:panelGrid>

                <p:separator style="margin:10px 0" />

                <p:commandButton value="Salvar" icon="pi pi-save"
                                action="#{pacienteBean.salvar}"
                                update=":formListaPacientes :formMensagens"
                                oncomplete="PF('dlgPaciente').hide()"
                                styleClass="ui-button-success" />
                <p:commandButton value="Cancelar" icon="pi pi-times"
                                type="button" onclick="PF('dlgPaciente').hide()"
                                styleClass="ui-button-secondary" />
            </h:form>
        </p:dialog>
    </ui:define>

</ui:composition>
